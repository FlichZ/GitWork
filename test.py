from docx import Document
from docx.shared import Pt
from docx.enum.text import WD_PARAGRAPH_ALIGNMENT
from docx.enum.table import WD_TABLE_ALIGNMENT

# Список всех тестовых случаев для системы учета документов
test_tables = [
    {
        "section": "1. Управление пользователями",
        "tables": [
            {
                "number": "Таблица 1",
                "description": "Регистрация нового пользователя",
                "cases": [
                    (
                        "Ввести корректные данные и нажать 'Добавить'",
                        "Пользователь создан и отображается в списке",
                        "Пользователь создан и отображается в списке",
                        "Пройден"
                    ),
                    (
                        "Оставить поле пустым и нажать 'Добавить'",
                        "Ошибка: «Все поля должны быть заполнены»",
                        "Ошибка: «Все поля должны быть заполнены»",
                        "Пройден"
                    ),
                    (
                        "Ввести существующий email и нажать 'Добавить'",
                        "Ошибка: «Email должен быть уникальным»",
                        "Ошибка: «Email должен быть уникальным»",
                        "Пройден"
                    ),
                ]
            },
            {
                "number": "Таблица 2",
                "description": "Авторизация пользователя",
                "cases": [
                    (
                        "Ввести корректные логин и пароль, нажать 'Войти'",
                        "Успешная авторизация и переход на дашборд",
                        "Успешная авторизация и переход на дашборд",
                        "Пройден"
                    ),
                    (
                        "Ввести неверные данные, нажать 'Войти'",
                        "Ошибка: «Неверный логин или пароль»",
                        "Ошибка: «Неверный логин или пароль»",
                        "Пройден"
                    ),
                    (
                        "Оставить поля пустыми, нажать 'Войти'",
                        "Ошибка: «Все поля должны быть заполнены»",
                        "Ошибка: «Все поля должны быть заполнены»",
                        "Пройден"
                    ),
                ]
            },
            {
                "number": "Таблица 3",
                "description": "Выход из аккаунта",
                "cases": [
                    (
                        "Нажать 'Выход' в авторизованной сессии",
                        "Успешный выход и переход на страницу входа",
                        "Успешный выход и переход на страницу входа",
                        "Пройден"
                    ),
                ]
            },
        ]
    },
    {
        "section": "2. Управление документами",
        "tables": [
            {
                "number": "Таблица 4",
                "description": "Отправка документа",
                "cases": [
                    (
                        "Заполнить форму и нажать 'Отправить'",
                        "Документ зарегистрирован и отображается в дашборде",
                        "Документ зарегистрирован и отображается в дашборде",
                        "Пройден"
                    ),
                    (
                        "Оставить поле пустым и нажать 'Отправить'",
                        "Ошибка: «Все поля должны быть заполнены»",
                        "Ошибка: «Все поля должны быть заполнены»",
                        "Пройден"
                    ),
                    (
                        "Загрузить файл больше лимита и нажать 'Отправить'",
                        "Ошибка: «Размер файла превышает лимит»",
                        "Ошибка: «Размер файла превышает лимит»",
                        "Пройден"
                    ),
                ]
            },
            {
                "number": "Таблица 5",
                "description": "Получение документа",
                "cases": [
                    (
                        "Заполнить форму и нажать 'Получить'",
                        "Документ зарегистрирован и отображается в дашборде",
                        "Документ зарегистрирован и отображается в дашборде",
                        "Пройден"
                    ),
                    (
                        "Оставить поле пустым и нажать 'Получить'",
                        "Ошибка: «Все поля должны быть заполнены»",
                        "Ошибка: «Все поля должны быть заполнены»",
                        "Пройден"
                    ),
                ]
            },
            {
                "number": "Таблица 6",
                "description": "Изменение статуса документа (PrimeTech)",
                "cases": [
                    (
                        "Выбрать статус и подтвердить (PrimeTech)",
                        "Статус обновлён и отражен в логе",
                        "Статус обновлён и отражен в логе",
                        "Пройден"
                    ),
                    (
                        "Изменить статус без прав PrimeTech",
                        "Функция недоступна",
                        "Функция недоступна",
                        "Пройден"
                    ),
                ]
            },
            {
                "number": "Таблица 7",
                "description": "Удаление документа (PrimeTech)",
                "cases": [
                    (
                        "Нажать 'Удалить' и подтвердить (PrimeTech)",
                        "Документ удалён из системы",
                        "Документ удалён из системы",
                        "Пройден"
                    ),
                    (
                        "Удалить документ без прав PrimeTech",
                        "Кнопка 'Удалить' недоступна",
                        "Кнопка 'Удалить' недоступна",
                        "Пройден"
                    ),
                ]
            },
        ]
    },
    {
        "section": "3. Управление дашбордом",
        "tables": [
            {
                "number": "Таблица 8",
                "description": "Фильтрация документов на дашборде",
                "cases": [
                    (
                        "Выбрать статус 'sent' и применить фильтр",
                        "Отображаются только отправленные документы",
                        "Отображаются только отправленные документы",
                        "Пройден"
                    ),
                    (
                        "Указать диапазон дат и применить фильтр",
                        "Отображаются документы в диапазоне",
                        "Отображаются документы в диапазоне",
                        "Пройден"
                    ),
                ]
            },
            {
                "number": "Таблица 9",
                "description": "Сортировка документов",
                "cases": [
                    (
                        "Сортировка по дате (убывание) и применить",
                        "Документы отсортированы по убыванию даты",
                        "Документы отсортированы по убыванию даты",
                        "Пройден"
                    ),
                    (
                        "Сортировка по статусу (возрастание) и применить",
                        "Документы отсортированы по статусу",
                        "Документы отсортированы по статусу",
                        "Пройден"
                    ),
                ]
            },
            {
                "number": "Таблица 10",
                "description": "Переключение вкладок Sent/Received",
                "cases": [
                    (
                        "Нажать вкладку 'Sent Documents'",
                        "Отображаются отправленные документы",
                        "Отображаются отправленные документы",
                        "Пройден"
                    ),
                    (
                        "Нажать вкладку 'Received Documents'",
                        "Отображаются полученные документы",
                        "Отображаются полученные документы",
                        "Пройден"
                    ),
                ]
            },
        ]
    },
    {
        "section": "4. Управление логами",
        "tables": [
            {
                "number": "Таблица 11",
                "description": "Просмотр логов документов",
                "cases": [
                    (
                        "Открыть страницу 'Document Log'",
                        "Отображается таблица логов",
                        "Отображается таблица логов",
                        "Пройден"
                    ),
                    (
                        "Нажать 'Download as Excel'",
                        "Файл Excel скачан",
                        "Файл Excel скачан",
                        "Пройден"
                    ),
                ]
            },
            {
                "number": "Таблица 12",
                "description": "Редактирование данных в логах",
                "cases": [
                    (
                        "Изменить поле и сохранить",
                        "Значение обновлено в таблице и базе",
                        "Значение обновлено в таблице и базе",
                        "Пройден"
                    ),
                    (
                        "Нажать 'Undo' после изменения",
                        "Предыдущее значение восстановлено",
                        "Предыдущее значение восстановлено",
                        "Пройден"
                    ),
                    (
                        "Нажать 'Redo' после отмены",
                        "Новое значение восстановлено",
                        "Новое значение восстановлено",
                        "Пройден"
                    ),
                ]
            },
        ]
    },
    {
        "section": "5. Управление базовыми документами",
        "tables": [
            {
                "number": "Таблица 13",
                "description": "Скачивание базовых документов",
                "cases": [
                    (
                        "Нажать 'Download' на документе",
                        "Файл скачан на устройство",
                        "Файл скачан на устройство",
                        "Пройден"
                    ),
                    (
                        "Открыть страницу без документов",
                        "Сообщение: «No documents available»",
                        "Сообщение: «No documents available»",
                        "Пройден"
                    ),
                ]
            },
        ]
    },
    {
        "section": "6. Тестирование безопасности",
        "tables": [
            {
                "number": "Таблица 14",
                "description": "Доступ без авторизации",
                "cases": [
                    (
                        "Открыть дашборд без авторизации",
                        "Перенаправление на страницу логина",
                        "Перенаправление на страницу логина",
                        "Пройден"
                    ),
                    (
                        "Отправить документ без авторизации",
                        "Перенаправление на страницу логина",
                        "Перенаправление на страницу логина",
                        "Пройден"
                    ),
                ]
            },
            {
                "number": "Таблица 15",
                "description": "Проверка прав доступа",
                "cases": [
                    (
                        "Изменить статус как обычный пользователь",
                        "Функция недоступна",
                        "Функция недоступна",
                        "Пройден"
                    ),
                    (
                        "Изменить статус как PrimeTech",
                        "Статус успешно изменён",
                        "Статус успешно изменён",
                        "Пройден"
                    ),
                ]
            },
        ]
    },
    {
        "section": "7. Тестирование производительности",
        "tables": [
            {
                "number": "Таблица 16",
                "description": "Производительность загрузки дашборда",
                "cases": [
                    (
                        "Открыть дашборд с 100 документами",
                        "Загрузка менее 2 секунд",
                        "Загрузка менее 2 секунд",
                        "Пройден"
                    ),
                ]
            },
            {
                "number": "Таблица 17",
                "description": "Экспорт логов",
                "cases": [
                    (
                        "Экспортировать 1000 записей в Excel",
                        "Экспорт завершен менее чем за 10 секунд",
                        "Экспорт завершен менее чем за 10 секунд",
                        "Пройден"
                    ),
                ]
            },
        ]
    },
    {
        "section": "8. Тестирование совместимости",
        "tables": [
            {
                "number": "Таблица 18",
                "description": "Совместимость с браузерами",
                "cases": [
                    (
                        "Открыть дашборд в Chrome",
                        "Интерфейс корректен, функции работают",
                        "Интерфейс корректен, функции работают",
                        "Пройден"
                    ),
                    (
                        "Открыть дашборд в Firefox",
                        "Интерфейс корректен, функции работают",
                        "Интерфейс корректен, функции работают",
                        "Пройден"
                    ),
                ]
            },
            {
                "number": "Таблица 19",
                "description": "Адаптивность на мобильных устройствах",
                "cases": [
                    (
                        "Открыть дашборд на iPhone",
                        "Интерфейс адаптивен, функции доступны",
                        "Интерфейс адаптивен, функции доступны",
                        "Пройден"
                    ),
                    (
                        "Открыть дашборд на Android",
                        "Интерфейс адаптивен, функции доступны",
                        "Интерфейс адаптивен, функции доступны",
                        "Пройден"
                    ),
                ]
            },
        ]
    },
]

# Заголовки таблиц
headers = ["№", "Действие (входные данные)", "Ожидаемый результат", "Фактический результат", "Результат"]

def create_table(document, table_info, headers):
    """
    Создаёт таблицу тестовых кейсов в документе с заданными параметрами.
    """
    section = table_info["section"]
    number = table_info["number"]
    description = table_info["description"]
    cases = table_info["cases"]

    # Добавление заголовка раздела
    document.add_heading(section, level=2).alignment = WD_PARAGRAPH_ALIGNMENT.LEFT

    # Добавление заголовка таблицы
    table_heading = document.add_paragraph(f"{number} - {description}")
    table_heading.style = 'Normal'
    table_heading.alignment = WD_PARAGRAPH_ALIGNMENT.LEFT
    table_heading.runs[0].font.size = Pt(12)

    # Определение количества строк и столбцов
    num_rows = len(cases) + 1  # +1 для заголовка
    num_cols = len(headers)

    # Создание таблицы
    table = document.add_table(rows=num_rows, cols=num_cols)
    table.style = 'Table Grid'
    table.alignment = WD_TABLE_ALIGNMENT.CENTER
    table.autofit = True

    # Заполнение заголовков таблицы
    hdr_cells = table.rows[0].cells
    for i, header in enumerate(headers):
        paragraph = hdr_cells[i].paragraphs[0]
        run = paragraph.add_run(header)
        run.font.name = 'Times New Roman'
        run.font.size = Pt(12)
        paragraph.alignment = WD_PARAGRAPH_ALIGNMENT.CENTER

    # Заполнение данных тестовых кейсов
    for idx, case in enumerate(cases, start=1):
        row_cells = table.rows[idx].cells

        # Заполнение столбца "№"
        paragraph = row_cells[0].paragraphs[0]
        run = paragraph.add_run(str(idx))
        run.font.name = 'Times New Roman'
        run.font.size = Pt(12)
        paragraph.alignment = WD_PARAGRAPH_ALIGNMENT.CENTER

        # Заполнение остальных столбцов
        for col_idx, content in enumerate(case):
            paragraph = row_cells[col_idx + 1].paragraphs[0]
            run = paragraph.add_run(content)
            run.font.name = 'Times New Roman'
            run.font.size = Pt(12)
            paragraph.alignment = WD_PARAGRAPH_ALIGNMENT.LEFT

def generate_test_report(test_tables):
    """
    Генерирует отчет с тестовыми случаями в соответствии с ГОСТом.
    """
    document = Document()

    # Установка общих стилей документа
    style = document.styles['Normal']
    font = style.font
    font.name = 'Times New Roman'
    font.size = Pt(12)

    # Добавление заголовка документа
    document.add_heading('Полный список тестовых данных', level=1).alignment = WD_PARAGRAPH_ALIGNMENT.CENTER

    # Добавление тестовых таблиц
    for section_info in test_tables:
        section = section_info["section"]
        for table_info in section_info["tables"]:
            table_info_with_section = table_info.copy()
            table_info_with_section["section"] = section
            create_table(document, table_info_with_section, headers)
            document.add_paragraph()  # Добавление пустой строки после таблицы

    # Добавление заключения
    document.add_heading('Заключение', level=1).alignment = WD_PARAGRAPH_ALIGNMENT.LEFT
    conclusion = document.add_paragraph(
        'Все представленные тестовые случаи были успешно пройдены, что подтверждает корректную работу системы учета входящих и исходящих документов. '
        'Рекомендуется проводить повторное тестирование после внесения изменений в функциональность системы для поддержания её стабильности.'
    )
    conclusion.style = 'Normal'
    conclusion.runs[0].font.size = Pt(12)

    # Сохранение документа
    file_path = "Тестовые_данные_для_Memo_Tracking_System.docx"
    document.save(file_path)
    print(f"Документ успешно сохранён как {file_path}")

# Генерация отчета
generate_test_report(test_tables)